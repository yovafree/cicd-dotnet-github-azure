name: 🚀 Despliegue manual a Azure

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Selecciona el entorno de despliegue"
        required: true
        default: "dev"
        type: choice
        options:
          - dev
          - prod

jobs:
  deploy:
    runs-on: ubuntu-latest

    env:
      IMAGE_NAME: starwarsmvc

    steps:
    - name: 🔐 Autenticarse en Azure
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    - name: ⚙️ Definir nombre de App según entorno
      id: setapp
      run: |
        if [[ "${{ github.event.inputs.environment }}" == "prod" ]]; then
          echo "APP_NAME=${{ secrets.AZURE_APP_PROD }}" >> $GITHUB_ENV
        else
          echo "APP_NAME=${{ secrets.AZURE_APP_DEV }}" >> $GITHUB_ENV
        fi

    - name: 🚀 Desplegar imagen a Azure Web App
      uses: azure/webapps-deploy@v2
      with:
        app-name: ${{ env.APP_NAME }}
        images: ${{ secrets.ACR_LOGIN_SERVER }}/${{ env.IMAGE_NAME }}:latest