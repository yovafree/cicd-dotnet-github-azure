name: 🚀 CD - Despliegue automático a Azure

on:
  push:
    branches:
      - master
      - developer

jobs:
  deploy:
    runs-on: ubuntu-latest

    env:
      IMAGE_NAME: starwarsmvc

    steps:
    - name: 🔐 Autenticarse en Azure
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    - name: ⚙️ Definir nombre del App Service según la rama
      run: |
        if [[ "${{ github.ref }}" == "refs/heads/master" ]]; then
          echo "APP_NAME=${{ secrets.AZURE_APP_PROD }}" >> $GITHUB_ENV
        elif [[ "${{ github.ref }}" == "refs/heads/developer" ]]; then
          echo "APP_NAME=${{ secrets.AZURE_APP_DEV }}" >> $GITHUB_ENV
        else
          echo "Rama no válida para despliegue" && exit 1
        fi

    - name: 🚀 Desplegar imagen a Azure Web App
      uses: azure/webapps-deploy@v2
      with:
        app-name: ${{ env.APP_NAME }}
        images: ${{ secrets.ACR_LOGIN_SERVER }}/${{ env.IMAGE_NAME }}:latest